<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Batucada Sequencer</title>
<link rel="stylesheet" href="style.css"/>
<link rel="manifest" href="app/app.webmanifest"/>
<link rel="icon" type="image/svg+xml" href="favicon.svg"/>
</head>
<body>
	<div id="sequencer">
		<a id="skip" href="#controls">Acc√©der aux boutons de contr√¥le</a>
		<h1 id="title"></h1>
		<table>
			<tr class="track" data-bars="4" data-beat="4" data-instrument="0" data-volume="30">
				<th scope="row">
					<div class="dropzone"></div>
					<div class="select" draggable="true">
						<div class="handle" title="D√©placer"></div> 
						<select name="instrument" class="instrument" aria-label="instrument" autocomplete="off">
							<option selected disabled hidden value="0">Instrument</option>
						</select>
						<select name="bars" class="bars" aria-label="nombre de temps" title="Nombre de temps" autocomplete="off">
							<optgroup label="Nombre de temps">
								<option selected>4</option>
								<option>6</option>
								<option>8</option>
								<option>12</option>
								<option>16</option>
								<option>24</option>
								<option>32</option>
							</optgroup>
						</select>
						<select name="beat" class="beat" aria-label="mesure" title="Mesure" autocomplete="off">
							<optgroup label="Mesure">
								<option value="3">3/4</option>
								<option selected value="4">4/4</option>
								<option value="6">6/8</option>
								<option value="8">8/8</option>
							</optgroup>
						</select>
					</div>
				</th>
				<td>
					<div class="sheet">
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
						<span class="bar"><button name="step" class="step" aria-label="note" value="0"></button><span class="sub_bar"><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button><button name="step" class="step" aria-label="note" value="0"></button></span></span>
					</div>
				</td>
				<td><input name="volume" class="volume" aria-label="volume" list="volume" title="Volume" type="range" value="30" min="0" max="60" autocomplete="off"></td>
			</tr>
		</table>
		<datalist id="volume">
			<option value="30"></option>
		</datalist>
		<div id="controls" role="toolbar" tabindex="-1">
			<div id="combo_presets" role="group">
				<button title="G√©rer le morceau">G√©rer le morceau</button>
				<select aria-label="morceaux">
					<option disabled hidden selected>Morceau</option>
					<option disabled>Aucun morceau</option>
				</select>
			</div>
			<label id="combo_tempo" for="tempo" title="Tempo">
				<input id="tempo" aria-label="tempo" type="range" value="80" min="60" max="160" step="4" autocomplete="off">
				<output for="tempo"><span>80</span> bpm</output>
			</label>
			<button id="reset">Effacer</button>
			<button id="start" role="switch" aria-checked="false" title="D√©marrer / Arr√™ter">
				<div id="play">D√©marrer</div>
				<div id="pause">Arr√™ter</div>
			</button>
		</div>
		<dialog id="settings">
			<div>
				<h2>G√©rer le morceau</h2>
				<form id="modify" method="dialog" hidden
					data-success="Le morceau a √©t√© enregistr√©."
					data-failure="‚ö†Ô∏è La modification a √©chou√©."
					data-cancel-success="La modification a √©t√© annul√©e."
					data-cancel-failure="‚ö†Ô∏è La modification ne peut √™tre annul√©e.">
					<fieldset>
						<legend>Enregistrer le morceau</legend>
						<input name="name" aria-label="nom du morceau" disabled>
						<button name="save">Enregistrer</button>
					</fieldset>
				</form>
				<form id="newOne" method="dialog"
					data-success="Le morceau a √©t√© enregistr√©."
					data-failure="‚ö†Ô∏è La modification a √©chou√©."
					data-cancel-success="La modification a √©t√© annul√©e."
					data-cancel-failure="‚ö†Ô∏è La modification ne peut √™tre annul√©e.">
					<fieldset>
						<legend>Enregistrer sous</legend>
						<input name="name" aria-label="nom du morceau" placeholder="Nom du morceau" autocomplete="off" required>
						<button name="save">Enregistrer</button>
					</fieldset>
				</form>
				<form id="rename" method="dialog" hidden
					data-success="Le morceau a √©t√© renomm√©."
					data-failure="‚ö†Ô∏è La modification a √©chou√©."
					data-cancel-success="La modification a √©t√© annul√©e."
					data-cancel-failure="‚ö†Ô∏è La modification ne peut √™tre annul√©e.">
					<fieldset>
						<legend>Renommer le morceau</legend>
						<input name="name" aria-label="nom du morceau" placeholder="Nom du morceau" autocomplete="off" required>
						<button name="save">Renommer</button>
					</fieldset>
				</form>
				<form id="delete" method="dialog" hidden
					data-success="Le morceau a √©t√© supprim√©."
					data-failure="‚ö†Ô∏è La modification a √©chou√©."
					data-cancel-success="La modification a √©t√© annul√©e."
					data-cancel-failure="‚ö†Ô∏è La modification ne peut √™tre annul√©e.">
					<fieldset>
						<legend>Supprimer le morceau</legend>
						<input name="name" aria-label="nom du morceau" disabled>
						<button name="save">Supprimer</button>
					</fieldset>
				</form>
				<form class="bottom" method="dialog">
					<button name="share_list">Partager</button><button>Fermer</button>
				</form>
			</div>
		</dialog>
		<dialog id="share">
			<form method="dialog" data-failure="üîó Lien de partage copi√© dans le presse-papier.">
				<h2>Partager</h2>
				<label><input type="checkbox" name="current">Morceau en cours</label>
				<label id="legend" title="Tout s√©lectionner / d√©s√©lectionner">
					<input type="checkbox" disabled>Morceaux enregistr√©s
				</label>
				<ul role="group" aria-labelledby="legend"></ul>
				<div class="bottom">
					<button name="share" disabled>Valider</button><button>Annuler</button>
				</div>
			</form>
		</dialog>
		<dialog id="shared">
			<div>
				<h2>Morceaux partag√©s</h2>
				<ul></ul>
				<form class="bottom" method="dialog" 
					data-success="Tous les morceaux ont √©t√© import√©s."
					data-failure="‚ö†Ô∏è L'import des morceaux a √©chou√©."
					data-cancel-success="L'import des morceaux a √©t√© annul√©."
					data-cancel-failure="‚ö†Ô∏è L'import des morceaux ne peut √™tre annul√©.">
					<button name="import">Importer</button><button>Fermer</button>
				</form>
			</div>
		</dialog>
		<div id="toast" popover="auto"><p></p><button name="cancel">Annuler</button></div>
	</div>
	<script type="module">
		import config       from './config.json' with { type: 'json' };
		import instruments  from './modules/instruments.json' with { type: 'json' };
		import {Interface}  from './modules/interface.js';
		import {Sequencer}  from './modules/sequencer.js';
		import {Presets}    from './modules/presets.js';
		import {UrlState}   from './modules/url_state.js';

		const bus       = new EventTarget();
		const ui        = new Interface(bus, config, instruments);
		const sequencer = new Sequencer(bus, config, instruments);
		const presets   = new Presets(bus, config);
		const urlState  = new UrlState(bus, config, instruments);

		if ('serviceWorker' in navigator) {
			navigator.serviceWorker.register('sw.js');
		}
	</script>
</body>
</html>